
######################################
# Author: Marijana Vujkovic
# Date: 2017
#
# snptest.rules
######################################

# create .sample including phenotypes and covariates
rule create_sample:
        output:
                "output/PROMIS/imputed/GWAS{cohort}/promis_gwas{cohort}.sample"
        shell:
                """
                Rscript R/create_sample.R '{wildcards.cohort}'
                """

# SNPTEST association
rule snptest:
  input:
    gz      = "/project/saleheenlab/original_data/PROMIS_GWAS12_1kG_phase3_imputed/GWAS{cohort}/by_chr/chr{chr}/promis_gwas{cohort}_chr_{chr}_{from}e6_{to}e6.gz",
    sample  = "/project/saleheenlab/snakemake/output/PROMIS/imputed/GWAS{cohort}/promis_gwas{cohort}.sample",
    exclude = "/project/saleheenlab/original_data/PROMIS_GWAS12_1kG_phase3_imputed/GWAS{cohort}/promis_gwas{cohort}_sample_exclusion.list",
  output:
    "/project/saleheenlab/snakemake/output/PROMIS/imputed/GWAS{cohort}/{pheno}/chr{chr}/promis_gwas{cohort}_chr{chr}:{from}e6_{to}e6.out"
  shell:
    """
    /project/saleheenlab/software/SNPTEST/snptest_v2.5.2/snptest_v2.5.2_linux_x86_64_static/snptest_v2.5.2 \
    -data {input.gz} {input.sample} \
    -o {output} \
    -genotype_field GP \
    -frequentist 1 \
    -method score \
    -pheno {wildcards.pheno} \
    -exclude_samples {input.exclude} \
    -hwe
    """
